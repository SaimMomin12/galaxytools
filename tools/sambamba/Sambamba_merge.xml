<tool id="sambamba_merge" name="Sambamba Merge" version="@WRAPPER_VERSION@" profile="23.2" license="MIT">
    <description>Merge several BAM files into one</description>
    <macros>
        <import>Sambamba_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>

    <command><![CDATA[
        sambamba merge
            -l $Compression_level
            #if $Filter
                 -F '${Filter}'
            #end if
            '${output}'
            #for $infile in $input_files:
                '${infile}'
            #end for
    ]]></command>
    <inputs>
        <param name="input_files" type="data" format="qname_sorted.bam,bam" multiple="true" label="Input BAM files to be merged" help="Please note that the sorting order of all input files must be the same"/>
        <expand macro="compression_level"/>
        <expand macro="filter"/>
    </inputs>
    <outputs>
        <data name="output" format_source="input_files"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_files" value="qname_sorted.bam,qname_sorted.bam"/>
            <param name="Compression_level" value="2"/> 
            <output name="output" file="qname_sorted_merged.bam" compare="sim_size" delta="434"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_files" value="coordinate_sorted.bam,coordinate_sorted.bam"/>
            <param name="Compression_level" value="2"/> 
            <output name="output" file="coordinate_sorted_merged.bam" compare="sim_size" delta="434"/>
        </test>
    </tests>

    <help>
<![CDATA[
@REFERENCES@

sambamba_merge is used to merge several sorted BAM files into one. The sorting order of all the files must be the same, and it is maintained in the output file.

SAM headers are merged automatically like in Picard merging tool.
]]>
    </help>
    <expand macro="citations" />
</tool>
